@using Admin.Components.Pages
@using Admin.Components.Shared.Business
@using Core.Dto
@using Core.Interfaces

@inherits LoadingPage

@inject IBusinessService BusinessService
@inject NavigationManager NavigationManager
@inject IMessageService MessageService

@ChildComponent


@code {
    [Parameter, EditorRequired]
    public RenderFragment ChildComponent { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Loading = true;

            var result = await BusinessService.GetBusinessForUser();

            if (!result.IsSuccess)
            {
                MessageService.AddMessage(new MessageBase("An error occured whilst loading.", MessageBase.MessageType.Error));
            }
            else if (result.Result == null)
            {
                NavigationManager.NavigateTo("/Business/Create");
            }

            Loading = false;
        }
    }
}
